<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="mStyle.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<div class="container-fluid">
	<div class="header col-lg-offset-1 col-md-offset-1 col-lg-10 col-md-10 col-sm-12 col-xs-12">
	  <!-- <img src="images/chibusoft_logo.png" width="141" height="33"> -->
	   <a href="#default" class="logo">Currency Converter</a>
	  <div class="header-right">
		<a class="active" href="#home">Home</a>
		<a href="#about">About</a>
	  </div>
	</div>
	
	
	<div class="row content_style">
			<div class="col-lg-offset-1 col-md-offset-1 col-lg-10 col-md-10 col-sm-12 col-xs-12">
			<h4 class="content_margin" id="description"></h4>
			</div>
		  <div class="col-lg-offset-1 col-md-offset-1 col-lg-10 col-md-10 col-sm-12 col-xs-12">
		  
			<form class="form-inline">
			
				<div class="form-group content_margin">
				<label class="sr-only" for="InputAmount">Amount</label>
				<div class="input-group">
				<input type="text" class="form-control" id="InputAmount" placeholder="Amount">
				<div class="input-group-addon">.00</div>
				</div>
				</div>
			
				<div class="form-group content_margin">
				
				<select class="form-control content_margin" id="from_currency">
				<option>From</option>
				</select>
				
				<div class="form-group content_margin">
				<h4> To </h4>
				</div>
				
				<select class="form-control content_margin" id="to_currency">
				<option>To</option>
				</select>

				<button type="submit" class="btn btn-primary content_margin" id="convertbtn" onclick="GetExchange();" >Convert</button>
			</form>
		   </div>
	  </div>
	</div>
	
			<div class="col-lg-offset-1 col-md-offset-1 col-lg-3 col-md-3 col-sm-12 col-xs-12">
			<h2 class="content_margin" id="result"></h4>
			</div>

</div>

	<div class="row footer">
		<div class="col-lg-offset-1 col-md-offset-1 col-lg-10 col-md-10 col-sm-12 col-xs-12">
			<h4><small> All rights reserved &copy; 2018 chibusoft.</small> </h4>
		</div>
	</div>

</div>

</body>
</html>

<script>	
	document.addEventListener("DOMContentLoaded",function(){

    //here code
	//document.getElementById('description').style.display = 'block'; // show
	//document.getElementById('result').style.display = 'none'; // hide
	
	//Hide these element on content load
	//document.getElementById('description').style.display = 'none'; 
	//document.getElementById('result').style.display = 'none'; 
	
	 LoadDropList();
	 
		//Prevent default button click
		document.getElementById("convertbtn").addEventListener("click", function(event){
		event.preventDefault()
		});
	});
	
	
	function LoadDropList() {

        console.log('started my function');

            const currencies = 'https://free.currencyconverterapi.com/api/v5/currencies?';

			//this method is to fetch url
			fetch(currencies, {
			method: 'get'
			}).then(function(response) {
				console.log('successful');
				return response.json();
			}).then(function(data) {
			
			console.log('Entered Data');
			//console.log(data.results);
			
			//get object count
			let count = Object.keys(data.results).length;
			
			console.log(count);
		
			//here we get reference to dropdown
			let fromOptions = document.getElementById('from_currency');
			let toOptions = document.getElementById('to_currency');
			
			//here we loop through to populate dropdown
			for (let i = 0; i < count; i++) {
				
				let to_values = document.createElement("option"); 
				to_values.textContent = Object.values(data.results)[i].currencyName;
				to_values.value = Object.values(data.results)[i].id;
				
				let from_values = document.createElement("option"); 
				from_values.textContent = Object.values(data.results)[i].currencyName;
				from_values.value = Object.values(data.results)[i].id;
				
				toOptions.appendChild(to_values);
				fromOptions.appendChild(from_values);
			}
			})
			.catch(function(err) {
				console.log(`Error failure  ${err}`);
			});

    };
	
	
	function GetExchange() {
	
			//here we get reference to html id's
			let fromOptions = document.getElementById('from_currency');
			let toOptions = document.getElementById('to_currency');
			let text_description = document.getElementById('description');
			const Input_Amount = document.getElementById('InputAmount').value
			let result = document.getElementById('result');
			
			const from_selected = {
			value : fromOptions.options[fromOptions.selectedIndex].value,
			Text : fromOptions.options[fromOptions.selectedIndex].textContent
			};
			
			const to_selected = {
			value : toOptions.options[toOptions.selectedIndex].value,
			Text : toOptions.options[toOptions.selectedIndex].textContent
			};
			
			
			
			console.log(`From selected = ${from_selected.value}`);
			console.log(`To selected currency = ${to_selected.value}`);
			
			const url = `https://free.currencyconverterapi.com/api/v5/convert?q=${from_selected.value}_${to_selected.value}&compact=ultra`;
			
			console.log(`selected url api = ${url}`);
			
			//fetch rate
			fetch(url, {
			method: 'get'
			}).then(function(response) {
				return response.json();
			}).then(function(data) {
			
			//get json returned value
			const exchange_value = Object.values(data)[0];
			
			console.log(exchange_value);
			
			//Display exchange value in text
			text_description.innerHTML = `Exchange rate from  ${from_selected.Text} to ${to_selected.Text} is ${exchange_value}`;
			
			
			//Display conversion
			console.log(`Input value = ${InputAmount}`);
			let my_result = Input_Amount * exchange_value;
			
			console.log(`Input value = ${my_result}`);
			result.innerHTML	 = `${to_selected.value} ${my_result}`;
			//result.style.display = 'block';
			
			})
			.catch(function(err) {
				console.log(`Error failure  ${err}`);
			});
			
			};
           
</script>

